# monitor_service - Process Monitor Service
#
# This service monitors critical processes and restarts them when needed

description "Process Monitor Service"
author "System Administrator"

# Start on runlevel 2,3,4,5 and stop on runlevel 0,1,6
start on runlevel [2345]
stop on runlevel [016]

# Respawn the service if it crashes
respawn
respawn limit 10 5

# Set environment
env CONFIG_FILE=/opt/monitor_service/config.ini
env LOG_FILE=/var/log/monitor_service.log

# Set working directory
chdir /opt/monitor_service

# Set the user that will run the service
setuid root
setgid root

# Pre-start script to ensure directories exist
pre-start script
    mkdir -p /opt/monitor_service
    mkdir -p /var/log/monitor_service
    
    # Ensure proper permissions
    chown root:root /opt/monitor_service
    chmod 755 /opt/monitor_service
    
    # Ensure log directory permissions
    chown root:root /var/log/monitor_service
    chmod 755 /var/log/monitor_service
end script

# The main script
script
    exec /opt/monitor_service/monitor_service.sh >> $LOG_FILE 2>&1
end script

# Pre-stop script
pre-stop script
    # Add any cleanup tasks here if needed
    echo "Stopping Process Monitor Service..." >> $LOG_FILE
end script
